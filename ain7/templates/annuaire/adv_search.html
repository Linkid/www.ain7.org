{% extends "annuaire/base.html" %}

{% load i18n %}

{% block content-left %}

<form action="." method="post">
<div>

{% if filtr %}
  {% if filtr.registered %}
    <h1>{% trans "Filter" %}&nbsp;: {{ filtr.name }}</h1>
  {% endif %}

  <div id="edition">

  {% if filtr.criteriaField.all or filtr.criteriaFilter.all %}
    <table class="datas">
    {% for criterion in filtr.criteriaField.all %}
      <tr class="{% cycle row1,row2 as rowvar %}">
        <td>{% if not forloop.first %}
          <a href="/annuaire/advanced_search/filter/{{ filtr.id }}/swapOp/">
            {{ filtr.operator }}
          </a>
          {% endif %}
        </td>
        <td>{{ criterion.fieldVerboseName|capfirst }}</td>
        <td>{{ criterion.comparatorVerboseName }}</td>
        <td>{{ criterion.displayedValue }}</td>
        <td><a href="/annuaire/advanced_search/filter/{{ filtr.id }}/criterion/{{ criterion.id }}/edit/field/" class="changelink">{% trans "Modify" %}</a></td>
        <td><a href="/annuaire/advanced_search/filter/{{ filtr.id }}/criterion/{{ criterion.id }}/delete/field/" class="deletelink">{% trans "Delete" %}</a></td>
      </tr>
    {% endfor %}

    {% for criterion in filtr.criteriaFilter.all %}
      <tr class="{% cycle rowvar %}">
        <td>{% if filtr.criteriaField.all or not forloop.first %}
          <a href="/annuaire/advanced_search/filter/{{ filtr.id }}/swapOp/">
            {{ filtr.operator }}
          </a>
          {% endif %}
        </td>
        <td>
          {% if criterion.is_in %}
            {% trans "belongs to filter" %}
          {% else %}
            {% trans "does not belong to filter" %}
          {% endif %}
        </td>
        <td>&nbsp;</td>
        <td>{{ criterion.filterCriterion }}</td>
        <td><a href="/annuaire/advanced_search/filter/{{ filtr.id }}/criterion/{{ criterion.id }}/edit/filter/" class="changelink">{% trans "Modify" %}</a></td>
        <td><a href="/annuaire/advanced_search/filter/{{ filtr.id }}/criterion/{{ criterion.id }}/delete/filter/" class="deletelink">{% trans "Delete" %}</a></td>
      </tr>
    {% endfor %}
    </table>
  {% else %}
    <p>{% trans "No criterion. Please add one." %}</p>
  {% endif %}
  </div>
{% else %}
  <p>{% trans "No criterion. Please add one." %}</p>
{% endif %}

<a href="/annuaire/advanced_search/filter/{{ filtr.id }}/criterion/add/" 
   class="addlink">{% trans "Add a criterion" %}</a>

<div style="text-align: center">
    <input type="submit" class="btn btn-primary" value="{% trans "Search" %}" />
</div>

</div>
</form>


{% if dosearch %}

<h2>{% trans "Results list"%}</h2>

{% ifnotequal hits 0 %}
<table style="width: 100%">
<tr>
<td><b>{{ first_result }} â†’ {{ last_result }}</b> {% trans "of" %} {{ hits }} {% trans "results" %}</td>
<td align="right">
{% if is_paginated %}
{% if has_previous %}<a href="/annuaire/advanced_search/{% if filtr %}filter/{{ filtr.id }}/{% endif %}?page=1">{% trans "First" %}</a>{% else %}{% trans "First" %}{% endif %} - 
{% if has_previous %}<a href="/annuaire/advanced_search/{% if filtr %}filter/{{ filtr.id }}/{% endif %}?page={{ previous_page }}">{% trans "Previous" %}</a>{% else %}{% trans "Previous" %}{% endif %} - 
{% if has_next %}<a href="/annuaire/advanced_search/{% if filtr %}filter/{{ filtr.id }}/{% endif %}?page={{ next_page }}">{% trans "Next" %}</a>{% else %}{% trans "Next" %}{% endif %} -
{% if has_next %}<a href="/annuaire/advanced_search/{% if filtr %}filter/{{ filtr.id }}/{% endif %}?page={{ pages }}">{% trans "Last" %}</a>{% else %}{% trans "Last" %}{% endif %}
{% endif %}
</td>
</tr>
</table>
    <ul>
    {% for ain7member in ain7members %}
        <li class="person"><a href="/annuaire/{{ ain7member.person.user.id }}/">
            {{ ain7member.person.last_name }} {{ ain7member.person.first_name }}</a> 
            {% for promo in ain7member.promos.all %}
               {% if forloop.last %} ({{ promo }}){% endif %}
            {% endfor %}
				</li>
    {% endfor %}
     </ul>
{% else %}
    <p>{% trans "No person matched your criteria." %}</p>
{% endifnotequal %}
{% endif %}
{% endblock %}



{% block worksheet-export %}
  <li><a href="{% url ain7.annuaire.views.adv_export_csv %}">{% trans "Worksheet export" %}</a></li>
{% endblock %}

{% block navigation %}
   <h2>{% trans "Navigation" %}</h2>
   <div class="grey-box">
   <ul>
      <li><a href="/annuaire/">{% trans "Simple Search" %}</a></li>
      {% if filtr.registered %}
        <li><a href="/annuaire/advanced_search/">{% trans "Advanced Search (homepage)" %}</a></li>
      {% endif %}
   </ul>
   </div>
{% endblock %}

